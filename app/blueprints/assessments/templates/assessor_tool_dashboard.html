{% extends "base.html" %}
{%- from 'govuk_frontend_jinja/components/inset-text/macro.html' import govukInsetText -%}
{%- from "govuk_frontend_jinja/components/button/macro.html" import govukButton -%}

{% from "macros/banner_summary.html" import banner_summary %}
{% from "macros/logout_partial.html" import logout_partial %}
{% from "macros/fund_dashboard_summary.html" import fund_summary %}
{% from "macros/assessor_tool_dashboard_filters.html" import assessor_tool_dashboard_filters %}
{% from "macros/migration_banner.html" import migration_banner %}

{% set pageHeading %}Assessment tool dashboard{% endset %}
{% block content %}
    <div class="govuk-phase-banner flex-parent-element">
        {{ logout_partial(sso_logout_url) }}
    </div>

    <div class="govuk-width-container">
        {% if migration_banner_enabled %}
            {{ migration_banner() }}
        {% endif %}

        <h1 class="govuk-heading-xl">Funding service dashboard</h1>

        <div class="govuk-grid-column">
            {{ assessor_tool_dashboard_filters(landing_filters, has_any_assessor_role) }}
        </div>

        <h2 class="govuk-heading-l">
            All funds ({{ funds | length }}), sorted A-Z
        </h2>

        <div class="govuk-accordion" data-module="govuk-accordion" id="accordion-default">
            {% if funds %}
            <div class="govuk-accordion__controls">
                <button type="button" class="govuk-accordion__show-all">
                    <span class="govuk-accordion-nav__chevron govuk-accordion-nav__chevron--down"></span>
                    <span class="govuk-accordion__show-all-text" data-qa="show_all_sections">Show all sections</span>
                </button>
            </div>
            {% endif %}
            {% for fund_id in funds %}
                <div class="govuk-accordion__section">
                    <div class="govuk-accordion__section-header">
                        <h2 class="govuk-accordion__section-heading">
                            <button type="button" aria-controls="accordion-default-content-{{ loop.index }}"
                                    class="govuk-accordion__section-button landing-accordion" data-qa="show"
                                    aria-label="{{ funds[fund_id].name }} ({{ fund_summaries[fund_id] | length }}), Show this section">
                                <span class="govuk-accordion__section-heading-text" id="accordion-default-heading-{{ loop.index }}">
                                    <span class="govuk-accordion__section-heading-text-focus">
                                      {{ funds[fund_id].name }} ({{ fund_summaries[fund_id] | length }})
                                    </span>
                                </span>
                                <span class="govuk-visually-hidden govuk-accordion__section-heading-divider">, </span>
                                    <span class="govuk-accordion__section-toggle" data-nosnippet="">
                                    <span class="govuk-accordion__section-toggle-focus">
                                        <span class="govuk-accordion-nav__chevron govuk-accordion-nav__chevron--down"></span>
                                        <span class="govuk-accordion__section-toggle-text">Show</span>
                                    </span>
                                </span>
                            </button>
                        </h2>
                        <div id="accordion-default-content-{{ loop.index }}" class="govuk-accordion__section-content"
                             aria-labelledby="accordion-default-heading-{{ loop.index }}" style="display: none">
                            {% if fund_summaries[fund_id] %}
                                {% set chunk_size = 3 %}
                                {% set summaries = fund_summaries[fund_id] %}
                                {% for chunk in summaries|batch(chunk_size) %}
                                    <div class="govuk-grid-row">
                                        {% for summary in chunk %}
                                            {{ fund_summary(summary, force_open_all_live_assessment_rounds) }}
                                        {% endfor %}
                                    </div>
                                {% endfor %}
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>

        <p class="govuk-!-padding-top-6 govuk-body govuk-!-display-inline-block">
            Information last updated: [{{ todays_date }}]<br/>
            Refresh page for most up-to-date information.
        </p>

    </div>

{% endblock content %}
