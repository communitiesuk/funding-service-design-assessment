{% extends "base.html" %}
{%- from 'govuk_frontend_jinja/components/back-link/macro.html' import govukBackLink -%}
{%- from "govuk_frontend_jinja/components/table/macro.html" import govukTable -%}
{% from 'macros/section_element.html' import section_element -%}
{% from 'macros/criteria_element.html' import criteria_element -%}
{% from "macros/banner_summary.html" import banner_summary %}
{% from "macros/flag_application_button.html" import flag_application_button %}
{% from "macros/assessment_flag.html" import assessment_flag %}
{% from "macros/logout_partial.html" import logout_partial %}

{% block content %}
    <div class="govuk-phase-banner flex-parent-element">
        <p class="govuk-!-text-align-left flex-parent-element flexed-element-margins-collapse">
            {{ govukBackLink({'href': url_for("assess_bp.landing"), 'text': 'Back to assessment dashboard'}) }}
        </p>
        {{ logout_partial(sso_logout_url) }}
    </div>

    {% if flag and g.user.highest_role in ("ASSESSOR", "LEAD_ASSESSOR") and not state.flag_resolved %}
        {{ assessment_flag(flag, flag_user_info, application_id) }}
    {% endif %}

    {{ banner_summary(
        state.fund_name,
        state.short_id,
        state.project_name,
        state.funding_amount_requested,
        state.workflow_status
    ) }}

    <div class="govuk-width-container">
        <div class="govuk-grid-row">
            <div class="govuk-grid-column-full">
                <div>
                    <div class="govuk-grid-column-two-thirds">
                        {% for section in state.sections %}
                            {{ section_element(section.name, section.sub_criterias, application_id) }}{% endfor %}
                        <h2 class="govuk-heading-l govuk-!-margin-top-8">Scored</h2>
                        <p class="govuk-body">Assess all responses under each sub criteria.</p>
                        {% for criteria in state.criterias %}
                            {% set name_classes = "govuk-heading-m govuk-!-margin-bottom-2" %}
                            {% if loop.index > 0 %}
                                {% set name_classes = "govuk-heading-m govuk-!-margin-bottom-2 govuk-!-margin-top-8" %}
                            {% endif %}
                            {{ criteria_element(criteria, name_classes, application_id) }}
                        {% endfor %}
                    </div>
                    <div class="govuk-grid-column-one-third govuk-!-margin-top-2">
                        {% if (not flag or state.flag_resolved) and g.user.highest_role in ("ASSESSOR", "LEAD_ASSESSOR") %}
                            {{ flag_application_button(application_id) }}
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
