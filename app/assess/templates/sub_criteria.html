{% extends "base.html" %}
{%- from 'govuk_frontend_jinja/components/back-link/macro.html' import govukBackLink -%}
{% from "macros/scores_justification.html" import scores_justification %}
{% from "macros/theme.html" import theme %}
{% from "macros/sub_criteria_navbar.html" import navbar %}
{% from "macros/banner_summary.html" import banner_summary %}
{% from "macros/flag_application_button.html" import flag_application_button %}
{% from "macros/comments.html" import comment %}
{% from "macros/comments_summary.html" import comment_summary %}
{% from "macros/comments_box.html" import comment_box %}


{% block content %}

    <div class="govuk-phase-banner flex-parent-element">
        <p class="govuk-!-text-align-left flex-parent-element flexed-element-margins-collapse">{{ govukBackLink({'href': url_for("assess_bp.application", application_id=application_id), 'text': 'Back to assessment overview'}) }}</p>
        <p class="flex-parent-element flexed-element-margins-collapse govuk-!-text-align-right"><a href="{{ sso_logout_url }}" class="govuk-link flexed-element-margins-collapse">Log out</a></p>
    </div>

    {{ banner_summary(
        fund.name,
        sub_criteria.short_id,
        sub_criteria.project_name,
        sub_criteria.funding_amount_requested,
        sub_criteria.workflow_status
    ) }}

    <div class="govuk-width-container">
        {% if not is_flagged and g.user.highest_role in ("ASSESSOR", "LEAD_ASSESSOR") %}
            {{ flag_application_button(application_id) }}
        {% endif %}
        <div class="govuk-grid-row">
            <div class="govuk-grid-column-one-third content-container">
                <h2 class="govuk-heading-l scoring-heading">{{ sub_criteria.name }}</h2>
            </div>
        </div>

    <div class="govuk-grid-row">
        <div class="govuk-grid-column-full">
            <div class="govuk-grid-column-one-third">
                {{ navbar(application_id, sub_criteria, current_theme_id, on_summary) }}
            </div>
            <div class="theme govuk-grid-column-two-thirds">
                {% if on_summary and g.user.highest_role in ["ASSESSOR","LEAD_ASSESSOR"] %}
                    {{scores_justification(scores_submitted, form, score_list, latest_score, application_id, sub_criteria.id, COF_score_list, score_error, justification_error)}}
                {% else %}
                    {{theme(current_theme_id, answers_meta)}}
                {% endif %}
                {%if current_theme_id == "score"%}
                {{comment_summary(comments,sub_criteria.themes)}}
                {% else %}
                {{comment(comments)}}
                {% endif %}
                {% if display_comment_box != True %}
                    <form method="GET">
                        <button id="comment" class="govuk-button secondary-button govuk-!-margin-top-2" type="submit" data-module="govuk-button" value="add-comment">
                            {% if comments == None %} Add a comment
                            {% else %} Add another comment
                            {% endif %}
                        </button>
                        <input type="hidden" name="theme_id" value="{{current_theme_id}}">
                        <input type="hidden" name="expand-comment-box" value="1">
                    </form>
                    {% endif %}

                    {% if display_comment_box == True %}
                        {{ comment_box(comment_form) }}
                    {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
