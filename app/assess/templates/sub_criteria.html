{% extends "base.html" %}
{%- from 'govuk_frontend_jinja/components/back-link/macro.html' import govukBackLink -%}
{% from "macros/theme.html" import theme %}
{% from "macros/sub_criteria_navbar.html" import navbar %}
{% from "macros/banner_summary.html" import banner_summary %}
{% from "macros/flag_application_button.html" import flag_application_button %}
{% from "macros/comments.html" import comment %}
{% from "macros/comments_box.html" import comment_box %}
{% from "macros/logout_partial.html" import logout_partial %}
{% set pageHeading -%}
{% if current_theme.id == sub_criteria.id %}
{{ sub_criteria.name }} - {{sub_criteria.project_name}}
{% else %}
{{current_theme.name}} - {{ sub_criteria.name }} - {{sub_criteria.project_name}}
{% endif %}
{% endset %}
{% block content %}
    <div class="govuk-phase-banner flex-parent-element">
        <p class="govuk-!-text-align-left flex-parent-element flexed-element-margins-collapse">
            <a href="{{url_for('assess_bp.application', application_id=application_id)}}" class="govuk-back-link" id="back-to-assessment-overview-link">
                Back to <b>assessment overview</b></a>
        </p>

        {{ logout_partial(sso_logout_url) }}

    </div>

    {% if current_theme_id == 'score' %}
        {% if score_form.errors.get('score') or score_form.errors.get('justification') %}
                <div class="govuk-error-summary" data-module="govuk-error-summary">
                    <div role="alert">
                    <h2 class="govuk-error-summary__title">
                        There is a problem
                    </h2>
                    <div class="govuk-error-summary__body">
                        <ul class="govuk-list govuk-error-summary__list">
                            {% if score_form.errors.get('score') %}
                                <li>
                                    <a href="#score-div">Select a score</a>
                                </li>
                            {% endif %}
                            {% if score_form.errors.get('justification') %}
                                <li>
                                    <a href="#just-text-area">Add rationale for score</a>
                                </li>
                            {% endif %}
                        </ul>
                    </div>
                    </div>
                </div>
            {% endif %}
    {% endif %}

    {% if comment_form.comment.errors %}
        <div class="govuk-error-summary" data-module="govuk-error-summary">
            <div role="alert">
            <h2 class="govuk-error-summary__title">
                There is a problem
            </h2>
            <div class="govuk-error-summary__body">
                <ul class="govuk-list govuk-error-summary__list">
                        <li>
                            <a href="#comments">Add a comment</a>
                        </li>
                </ul>
            </div>
            </div>
        </div>
    {% endif %}
    

    {{ banner_summary(
        fund.name,
        sub_criteria.short_id,
        sub_criteria.project_name,
        sub_criteria.funding_amount_requested,
        display_status,
        g.user.highest_role,
    ) }}
    <div class="govuk-width-container">
        {% if not is_flagged and g.user.highest_role in ("ASSESSOR", "LEAD_ASSESSOR") %}
            {{ flag_application_button(application_id) }}
        {% endif %}
        <div class="govuk-grid-row">
            <div class="govuk-grid-column-one-third content-container">
                <h2 class="govuk-heading-l scoring-heading">{{ sub_criteria.name }}</h2>
            </div>
        </div>

    <div class="govuk-grid-row">
        <div class="govuk-grid-column-full">
            <div class="govuk-grid-column-one-third">
                {{ navbar(application_id, sub_criteria, current_theme_id) }}
            </div>
            <div class="theme govuk-grid-column-two-thirds">
                {{theme(current_theme_id, answers_meta)}}
                {{comment(comments)}}
                {% if display_comment_box != True %}
                    <a
                        id="comment"
                        class="govuk-button secondary-button govuk-!-margin-top-2 govuk-!-margin-bottom-6"
                        type="submit"
                        data-module="govuk-button"
                        href="{{ url_for(
                            "assess_bp.display_sub_criteria",
                            application_id=application_id,
                            sub_criteria_id=sub_criteria.id,
                            theme_id=current_theme_id,
                            add_comment="1",
                            _anchor="comment"
                        ) }}"
                    >
                        {% if comments == None %} Add a comment
                        {% else %} Add another comment
                        {% endif %}
                    </a>
                    {% endif %}

                    {% if display_comment_box == True %}
                        {{ comment_box(comment_form) }}
                    {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
