{% from "govuk_frontend_jinja/components/input/macro.html" import govukInput %}


{% macro render(application_overviews, query_params, asset_types, assessment_statuses, show_clear_filters) -%}
<div class="govuk-grid-row">
  <div class="govuk-grid-column-full search-bar-flex-container">
    <div>
    <form method="get">
      <div class="govuk-form-group govuk-!-display-inline-block govuk-!-padding-right-2">
            <div>
                  <label class="govuk-label" for="application_search">
                    Search reference or project name
                  </label>
                  <input class="govuk-input govuk-input--width-20" type="text" s, assessment_statusespellcheck="false" aria-label="Search reference or project name" id="application_search" name="search_term", value="{{query_params['search_term']}}">
            </div>
      </div>
      <div class="govuk-form-group govuk-!-display-inline-block govuk-!-padding-right-2">
            <label class="govuk-label" for="filter_asset_type">
            Filter by asset type
            </label>
            <select class="govuk-select" id = "filter_asset_type" name="asset_type">

                  {% for item in asset_types %}
                        <option value='{{ item }}' {% if query_params.asset_type == item %} selected=""{%endif%}>{{asset_types[item]}}</option>
                  {% endfor %}

            </select>
      </div>

      <div class="govuk-form-group govuk-!-display-inline-block govuk-!-padding-right-2">
            <label class="govuk-label" for="filter_status">
            Filter by status
            </label>
            <select class="govuk-select" name="status" id="filter_status">
                  {% for item in assessment_statuses %}
                        <option value='{{ item }}' {% if query_params.status == item %} selected=""{%endif%}>{{assessment_statuses[item]}}</option>
                  {% endfor %}
            </select>
            <button class="govuk-button search-button" aria-lbel = "Search" type="submit">Search</button>
      </div>
  </form>
  </div>
  {% if show_clear_filters == true %}
  <p>
    <a class="govuk-link govuk-link--no-visited-state" href="{{url_for('assess_bp.landing', clear_filters=true)}}" aria-label="Clear Filters">Clear Filters</a>
  </p>
  {%endif%}

  </div>

</div>

{% if not application_overviews %}
<p class="govuk-body">
  <strong>No matching results.</strong>
</p>
<p class="govuk-body">Improve your results by:</p>
<ul class="govuk-list govuk-list--bullet">
  <li>removing filters</li>
  <li>double-checking your spelling</li>
</ul>
{% else %}
<table class="govuk-table" id="application_overviews_table">


  <thead class="govuk-table__head">
    <tr class="govuk-table__row">

      <th scope="col" class="govuk-table__header">
          Reference
      </th>


      <th scope="col" class="govuk-table__header">
            Project name
      </th>


      <th scope="col" class="govuk-table__header">
        Asset type
      </th>


      <th scope="col" class="govuk-table__header">
        Funding requested
      </th>

      <th scope="col" class="govuk-table__header">
        Location
      </th>


      <th scope="col" class="govuk-table__header">
        Status
      </th>

    </tr>
  </thead>

  <tbody class="govuk-table__body">
        {% for overview in application_overviews %}
            <tr class="govuk-table__row">

                <td class="govuk-table__cell">{{overview.short_id[-6:]}}</td>

                <td class="govuk-table__cell"><a class="govuk-link" href="{{url_for('assess_bp.application',application_id=overview.application_id)}}">{{overview.project_name}}</a></td>
                <td class="govuk-table__cell">{{asset_types[overview.asset_type]}}</td>
                <td class="govuk-table__cell">&pound;{{ "{:,.2f}".format(overview.funding_amount_requested|int|round) }}</td>
                <td class="govuk-table__cell">{{ overview.location }}</td>
                {% if overview.workflow_status ==  "not-started" %}
                  <td class="govuk-table__cell"><span class="not-started-tag">{{assessment_statuses[overview.workflow_status]}}</span></td>
                {% else %}
                  <td class="govuk-table__cell">{{assessment_statuses[overview.workflow_status]}}</td>
                {% endif %}
            </tr>
        {% endfor %}
  </tbody>
</table>
{% endif %}
{%- endmacro %}
